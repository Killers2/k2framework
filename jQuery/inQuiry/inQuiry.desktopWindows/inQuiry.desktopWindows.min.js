/*!
 * PLUGIN inQuiry DesktopWindows V1.2 (Based on KioskOs)
 * @laguage: Javascript ES6
 * @author: Tony N. Hyde (Date: 23 January 2022)
 * @Dependencies: jQuery, inQuiry.Extentions.js, inQuiry.objectCookie.js, inQuiry.toolTip.js, inQuiry.contextMenu.js
 * @Optional Dependencies: GSAP (https://greensock.com/gsap/) (https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js)
 */
!function($){"use strict";$.desktopWindows={TOPLEFT:1,TOPRIGHT:2,BOTTOMLEFT:3,BOTTOMRIGHT:8,CENTER:16,STATIC:32,NORESIZE:64,APPNORMAL:128,APPSERVICE:256,APPSETTING:512,shield:null,desktop:null,appsbar:null,taskbar:null,serviceappsbox:null,settingsappsbox:null,selectedwindowid:"",maxzindex:214748e4,openwindows:[],setUpDesktop:function(selector){this.element=$(selector)[0],this.width=function(){return parseInt($(this.element).css("width").replace("px",""))},this.height=function(){return parseInt($(this.element).css("height").replace("px",""))}},setUpAppsBar:function(environment){var ab=$("<div />",{id:"desktop-appsbar",class:"desktop-appsbar"});environment.append(ab),this.element=ab[0],this.appLinks=[],this.refresh=function(){"0px"==$(".desktop-desktop").css("left")?$(".desktop-appsbar-icon").each((idx,item)=>{$(item).uiToolTip({position:$.uiToolTipPos.TOP})}):$(".desktop-appsbar-icon").each((idx,item)=>{$(item).uiToolTip({position:$.uiToolTipPos.RIGHT})})},this.add=function(options){var defaults={id:"",img:"",contextmenu:!1,applicationname:"",tooltipDirection:"RIGHT",tooltipContent:"",action:()=>{}};options=$.extend({},defaults,options);var abs=$("<a />",{id:options.id,class:"desktop-appsbar-icon",href:"javascript:void(0);",contextmenu:options.contextmenu,applicationname:options.applicationname,"ui-tooltip-point":options.tooltipDirection,"ui-tooltip":options.tooltipContent});""!=options.img&&null!=options.img&&abs.append($("<img />",{alt:"",src:options.img})),$(this.element).append(abs),abs.uiToolTip(),abs.on("click",options.action),this.appLinks.push(abs[0])}},setUpTaskBar:function(selector){this.element=$(selector)[0]},setUpServiceAppsBox:function(environment){this.element=$("<div />",{id:"desktop-services-apps",class:"desktop-services-apps"}),$(environment).append(this.element),$("#btn_taskbar_services").on("click",()=>{$(this.element).hasClass("desktop-services-apps-show")||$(this.element).children().length>0&&$(this.element).addClass("desktop-services-apps-show").onClickOut(()=>{$(this.element).removeClass("desktop-services-apps-show")})}),this.appLinks=[],this.add=function(options){var defaults={id:"",img:"",action:()=>{}};options=$.extend({},defaults,options);var temp=$("<a />",{id:options.id,class:"desktop-taskbar-icon",href:"javascript:void(0);"});temp.append($("<img />",{alt:"",src:options.img})),this.element.append(temp),temp.on("click",options.action),this.appLinks.push(temp[0])},this.hide=()=>{this.element.removeClass("desktop-services-apps-show")},this.show=()=>{this.element.addClass("desktop-services-apps-show")}},setUpSettingsAppsBox:function(environment){this.element=$("<div />",{id:"desktop-settingsbar",class:"desktop-settingsbar"}),$(environment).append(this.element),$("#btn_taskbar_settings").on("click",()=>{$(this.element).hasClass("desktop-settingsbar-show")||$(this.element).addClass("desktop-settingsbar-show").onClickOut(()=>{$(this.element).removeClass("desktop-settingsbar-show")})}),this.settingLinks=[],this.add=options=>{var defaults={id:"",img:"",tooltipContent:"",action:()=>{}};options=$.extend({},defaults,options);var temp=$("<a />",{id:options.id,class:"desktop-appsbar-icon",href:"javascript:void(0);","ui-tooltip-point":"LEFT","ui-tooltip":options.tooltipContent});temp.append($("<img />",{alt:"",src:options.img})),this.element.append(temp),temp.on("click",options.action),temp.uiToolTip(),this.settingLinks.push(temp[0])},this.hide=()=>{this.element.removeClass("desktop-settingsbar-show")},this.show=()=>{this.element.addClass("desktop-settingsbar-show")}},setUpShield:function(selector,backcolor,transparency){this.element=$(selector)[0],this.element.style.visibility="hidden",this.element.style.position="absolute",this.element.style.left="0px",this.element.style.top="0px",this.element.style.backgroundColor=backcolor,this.element.style.opacity=.01*transparency,this.element.style.filter="alpha(opacity="+transparency+")",this.element.style.zIndex=2147479999,this.hide=function(){$("#"+$.desktopWindows.shield.element.id).off("contextmenu"),this.element.style.visibility="hidden",this.element.style.width="0px",this.element.style.height="0px",this.element.style.zIndex=2147479999},this.show=function(){$("#"+$.desktopWindows.shield.element.id).on("contextmenu",(function(e){return e.preventDefault(),!1})),this.element.style.zIndex=$.desktopWindows.maxzindex+1,this.element.style.visibility=""},this.resize=function(){if(""==this.element.style.visibility){var s=document.documentElement.scrollHeight,r=$.inQuiry.screen.dimentions();this.element.style.width=r.width+"px",($.inQuiry.browser.firefox||$.inQuiry.browser.msie||$.inQuiry.browser.mozilla)&&(this.element.style.height=r.height+(s-r.height)+"px"),($.inQuiry.browser.chrome||$.inQuiry.browser.safari||$.inQuiry.browser.opera)&&(s<r.height?this.element.style.height=r.height+"px":(this.element.style.width=r.width-17+"px",this.element.style.height=r.height+(s-r.height)+"px")),$.inQuiry.browser.msie&&(null!=s||s>0)&&(this.element.style.width=r.width-17+"px"),"hidden"!=$("html").css("overflow")&&"hidden"!=$("body").css("overflow")||(this.element.style.width=r.width+"px")}}},window:function(options){this.defaults={windowId:"WindowX",width:500,height:365,position:$.desktopWindows.TOPLEFT,margin:100,shield:!1,statusBar:!1,onload:null,onclose:null,onresize:null,ondoubleclick:null,onfocus:null,onmaximize:null,onminimize:null,onrestore:null,windowicon:"",appType:$.desktopWindows.APPNORMAL},this.defaults=$.extend({},this.defaults,options),this.windowframe=null,this.windowheader=null,this.windowcontent=null,this.windowstatusbar=null,this.windowtitle=null,this.btnClose=null,this.btnMaximize=null,this.btnMinimize=null,this.isMaximized=null,this.isMinimized=null,this.appsbarbutton=null,this.zIndex=214748e4,this.load=function(){var exsits=$.desktopWindows._getparms(this.defaults.windowId);if(null==exsits){var a,b,c,d,e,f,g,h,k,l;$.desktopWindows.openwindows.push(this),(a=document.createElement("div")).setAttribute("id","window_"+this.defaults.windowId),a.setAttribute("class","window-frame"),a.className="window-frame",a.setAttribute("style","visibility:hidden;position:absolute;min-width:"+this.defaults.width+"px;min-height:"+this.defaults.height+"px;width:"+this.defaults.width+"px;height:"+this.defaults.height+"px;"),a.style.visibility="hidden",a.style.position="absolute",a.style.width=this.defaults.width+"px",a.style.height=this.defaults.height+"px",a.style.left="0px",a.style.top="0px",(b=document.createElement("div")).setAttribute("id","window_"+this.defaults.windowId+"_header"),b.setAttribute("class","window-header"),b.className="window-header",""!=this.defaults.windowicon&&((l=document.createElement("img")).setAttribute("id","window_"+this.defaults.windowId+"_icon"),l.setAttribute("src",this.defaults.windowicon)),(c=document.createElement("span")).setAttribute("id","window_"+this.defaults.windowId+"_title"),c.innerHTML="Loading...",(d=document.createElement("div")).setAttribute("class","window-buttons"),d.className="window-buttons",(e=document.createElement("div")).setAttribute("id","window_"+this.defaults.windowId+"_btn_close"),e.setAttribute("class","window-button window-button-close"),e.className="window-button window-button-close",(f=document.createElement("div")).setAttribute("id","window_"+this.defaults.windowId+"_btn_maximize"),f.setAttribute("class","window-button window-button-maximize"),f.className="window-button window-button-maximize",(g=document.createElement("div")).setAttribute("id","window_"+this.defaults.windowId+"_btn_minimize"),g.setAttribute("class","window-button window-button-minimize"),g.className="window-button window-button-minimize",d.appendChild(e),d.appendChild(f),d.appendChild(g),""!=this.defaults.windowicon&&b.appendChild(l),b.appendChild(c),b.appendChild(d),(h=document.createElement("div")).setAttribute("id","window_"+this.defaults.windowId+"_content"),h.setAttribute("class","window-content"),h.className="window-content",h.innerHTML='<div class="window-content-loading">'+$.desktopWindows.getCssAjaxLoader()+"</div>",a.appendChild(b),a.appendChild(h);var hiddenCss="";if(this.defaults.statusBar||(hiddenCss=" window-statusbar-none"),(k=document.createElement("div")).setAttribute("id","window_"+this.defaults.windowId+"_statusbar"),k.setAttribute("class","window-statusbar"+hiddenCss),k.className="window-statusbar"+hiddenCss,a.appendChild(k),$.desktopWindows.desktop.element.appendChild(a),this.windowframe=document.getElementById("window_"+this.defaults.windowId),this.windowheader=document.getElementById("window_"+this.defaults.windowId+"_header"),this.windowcontent=document.getElementById("window_"+this.defaults.windowId+"_content"),this.windowstatusbar=document.getElementById("window_"+this.defaults.windowId+"_statusbar"),this.windowtitle=document.getElementById("window_"+this.defaults.windowId+"_title"),this.btnClose=document.getElementById("window_"+this.defaults.windowId+"_btn_close"),this.btnMaximize=document.getElementById("window_"+this.defaults.windowId+"_btn_maximize"),this.btnMinimize=document.getElementById("window_"+this.defaults.windowId+"_btn_minimize"),$(this.windowframe).css("z-index",$.desktopWindows.maxzindex),$.desktopWindows.maxzindex=parseInt($.desktopWindows.maxzindex)+1,!0===this.defaults.shield&&($.desktopWindows.shield.show(),$.desktopWindows.shield.resize(),this.windowframe.style.zIndex=this.windowframe.style.zIndex+1),null!=this.defaults.position){var m=null==this.defaults.margin?25:this.defaults.margin,r=$.inQuiry.screen.dimentions();(this.defaults.position&$.desktopWindows.TOPLEFT)==$.desktopWindows.TOPLEFT&&$(this.windowframe).css({transform:"translate("+m+"px,"+m+"px)",transition:"0s"}),(this.defaults.position&$.desktopWindows.TOPRIGHT)==$.desktopWindows.TOPRIGHT&&$(this.windowframe).css({transform:"translate("+r.width-(parseInt(this.windowframe.style.width.replace("px",""))+(m+38))+"px,"+m+"px)",transition:"0s"}),(this.defaults.position&$.desktopWindows.BOTTOMLEFT)==$.desktopWindows.BOTTOMLEFT&&$(this.windowframe).css({transform:"translate("+m+"px,"+r.height-(parseInt(this.windowframe.style.height.replace("px",""))+(m+20))+"px)",transition:"0s"}),(this.defaults.position&$.desktopWindows.BOTTOMRIGHT)==$.desktopWindows.BOTTOMRIGHT&&$(this.windowframe).css({transform:"translate("+r.width-(parseInt(this.windowframe.style.width.replace("px",""))+(m+38))+"px,"+r.height-(parseInt(this.windowframe.style.height.replace("px",""))+(m+20))+"px)",transition:"0s"}),(this.defaults.position&$.desktopWindows.CENTER)==$.desktopWindows.CENTER&&$(this.windowframe).css({transform:"translate("+(r.width/2-parseInt(this.windowframe.style.width.replace("px",""))/2)+"px,"+(r.height/2-parseInt(this.windowframe.style.height.replace("px",""))/2)+"px)",transition:"0s"})}if((this.defaults.position&$.desktopWindows.STATIC)!=$.desktopWindows.STATIC){var ca=new $.inQuiry.cookie.create("desktopWindows_"+this.windowframe.id,null);if(null==ca.read()){ca=new $.inQuiry.cookie.create("desktopWindows_"+this.windowframe.id,365);var pos=$(this.windowframe).cssTranslateValues();ca.keys.add(new $.inQuiry.cookie.item("x",pos.x+"px")),ca.keys.add(new $.inQuiry.cookie.item("y",pos.y+"px")),ca.keys.add(new $.inQuiry.cookie.item("w",this.windowframe.style.width)),ca.keys.add(new $.inQuiry.cookie.item("h",this.windowframe.style.height)),ca.save()}else{var deskW=$.desktopWindows.desktop.width(),deskH=$.desktopWindows.desktop.height(),winX=parseInt(ca.key("x").replace("px","")),winY=parseInt(ca.key("y").replace("px",""));winX<0&&(winX=0),winY<0&&(winY=0),winX>deskW&&(winX=0),winY>deskH&&(winY=0),$(this.windowframe).css({transform:"translate("+winX+"px,"+winY+"px)",transition:"0s"}),this.windowframe.style.width=ca.key("w"),this.windowframe.style.height=ca.key("h")}}$(this.btnClose).on("click",(function(evt){var id=this.id.substring(this.id.indexOf("_")+1);id=id.substring(0,id.indexOf("_")),$.desktopWindows.close(id)})),null!=this.defaults.onmaximize?$(this.btnMaximize).on("click",(function(evt){var id=this.id.substring(this.id.indexOf("_")+1),p=$.desktopWindows._getparms(id.substring(0,id.indexOf("_")));$.desktopWindows.maximize_restore(p),null!=p.onmaximize&&p.onmaximize(p)})):this.btnMaximize.style.display="none",null!=this.defaults.onminimize?$(this.btnMinimize).on("click",(function(evt){var id=this.id.substring(this.id.indexOf("_")+1),p=$.desktopWindows._getparms(id.substring(0,id.indexOf("_")));p.defaults.appType==$.desktopWindows.APPNORMAL&&""!=p.defaults.windowicon&&($(p.appsbarbutton).stop().css("background-color",$(".theme-base-colors").css("color")).animate({backgroundColor:$(".theme-base-colors").css("background-color")},400,()=>{$(p.appsbarbutton).animate({backgroundColor:$(".theme-base-colors").css("color")},400,()=>{$(p.appsbarbutton).animate({backgroundColor:$(".theme-base-colors").css("background-color")},300,()=>{$(p.appsbarbutton).removeAttr("style")})})}),p.isMinimized=!0,$(p.windowframe).fadeOut(200)),p.defaults.appType==$.desktopWindows.APPSERVICE&&$(p.windowframe).fadeOut(200),p.defaults.appType==$.desktopWindows.APPSETTING&&$(p.windowframe).fadeOut(200),null!=p.defaults.onminimize&&p.defaults.onminimize(p)})):this.btnMinimize.style.display="none",$(this.windowheader).on("contextmenu",(function(evt){return evt.preventDefault(),!1})),$(this.windowheader).on("mousedown",(function(evt){try{var id=this.id.substring(this.id.indexOf("_")+1),p=$.desktopWindows._getparms(id.substring(0,id.indexOf("_")));$.desktopWindows.maxzindex=parseInt($.desktopWindows.maxzindex)+1,$(p.windowframe).css("z-index",$.desktopWindows.maxzindex),null!=p.defaults.onfocus&&p.defaults.onfocus(p)}catch{}})),$(this.windowcontent).on("mousedown",(function(evt){try{var id=this.id.substring(this.id.indexOf("_")+1),p=$.desktopWindows._getparms(id.substring(0,id.indexOf("_")));$.desktopWindows.maxzindex=parseInt($.desktopWindows.maxzindex)+1,$(p.windowframe).css("z-index",$.desktopWindows.maxzindex),null!=p.defaults.onfocus&&p.defaults.onfocus(p)}catch{}})),null!=this.defaults.ondoubleclick&&$(this.windowheader).on("dblclick",(function(evt){var id=this.id.substring(this.id.indexOf("_")+1),p=$.desktopWindows._getparms(id.substring(0,id.indexOf("_")));$.desktopWindows.maximize_restore(p),null!=p.defaults.ondoubleclick&&p.defaults.ondoubleclick(p)})),(this.defaults.position&$.desktopWindows.NORESIZE)!=$.desktopWindows.NORESIZE&&$(this.windowframe).resizable("destroy").resizable({winFormMinHeight:null,winForm:null,start:function(event,ui){this.winForm=$.desktopWindows._getparms(ui.id.substring(ui.id.indexOf("_")+1)),this.winFormMinHeight=parseInt($(this.winForm.windowframe).css("min-height").replace("px",""))},resize:function(event,ui){if(!(ui.clientHeight<this.winFormMinHeight)){var initHeaderHeight=parseInt($(this.winForm.windowheader).css("height").replace("px","")),initBodyHeight=parseInt($(this.winForm.windowframe).css("height").replace("px","")),initStatusBarHeight=parseInt($(this.winForm.windowstatusbar).css("height").replace("px",""));$(this.winForm.windowcontent).css("height",initBodyHeight-(initHeaderHeight+initStatusBarHeight)+"px"),null!=this.winForm.onresize&&this.winForm.onresize(this,initBodyHeight-(initHeaderHeight+initStatusBarHeight))}},stop:function(event,ui){this.winForm=null,this.winFormMinHeight=null}}),(this.defaults.position&$.desktopWindows.STATIC)!=$.desktopWindows.STATIC&&($(this.windowframe).draggable("destroy").draggable({handle:$(this.windowheader),containment:$($.desktopWindows.desktop.element),scroll:!1,drag:function(event,ui){var p=$.desktopWindows._getparms(ui.id.substring(ui.id.indexOf("_")+1));if(p&&p.isMaximized)return!1}}),this.windowheader.style.cursor="default"),null!=this.defaults.onminimize&&""!=this.defaults.windowicon&&(this.defaults.appType==$.desktopWindows.APPNORMAL&&($($.desktopWindows.appsbar.element).append('<a id="btn_appsbar_'+this.defaults.windowId+'" contextmenu="true" applicationname="'+this.defaults.windowId+'" ui-tooltip="'+this.defaults.windowId+'" class="desktop-appsbar-icon" href="javascript:void(0);"><img alt="" src="'+this.defaults.windowicon+'" /></a>'),$("#btn_appsbar_"+this.defaults.windowId).ContextMenu({name:"app_"+this.defaults.windowId,bindings:[{command:"Open",iconClass:"fa fa-default",callback:(buttonItem,menuItem)=>{var windowId=$(menuItem).attr("id").replace("ctxmenu_app_",""),p=$.desktopWindows._getparms(windowId);p.isMinimized=!1,$.desktopWindows.desktop.element.appendChild(p.windowframe),(p.position&$.desktopWindows.STATIC)!=$.desktopWindows.STATIC&&$(p.windowframe).draggable({containment:$($.desktopWindows.desktop.element)}),$(p.windowframe).fadeIn(200),$.desktopWindows.maxzindex=parseInt($.desktopWindows.maxzindex)+1,$(p.windowframe).css("z-index",$.desktopWindows.maxzindex),null!=p.onrestore&&p.onrestore(p)}},{command:"-br"},{command:"Minimize",iconClass:"fa fa-default",callback:(buttonItem,menuItem)=>{var windowId=$(menuItem).attr("id").replace("ctxmenu_app_","");$("#btn_appsbar_"+windowId).stop().css("background-color",$(".theme-base-colors").css("color")).animate({backgroundColor:$(".theme-base-colors").css("background-color")},400,()=>{$("#btn_appsbar_"+windowId).animate({backgroundColor:$(".theme-base-colors").css("color")},400,()=>{$("#btn_appsbar_"+windowId).animate({backgroundColor:$(".theme-base-colors").css("background-color")},300,()=>{$("#btn_appsbar_"+windowId).removeAttr("style")})})});var p=$.desktopWindows._getparms(windowId);p.isMinimized=!0,$(p.windowframe).fadeOut(200),null!=p.onminimize&&p.onminimize(p.windowId)}},{command:"Close",iconClass:"fa fa-default",callback:(buttonItem,menuItem)=>{var windowId=$(menuItem).attr("id").replace("ctxmenu_app_","");$.desktopWindows.close(windowId)}},{command:"Hide",iconClass:"fa fa-default",callback:(buttonItem,menuItem)=>{if($.desktopWindows.taskbar){var windowId=$(menuItem).attr("id").replace("ctxmenu_app_",""),p=$.desktopWindows._getparms(windowId);p.isMinimized=!0,$(p.windowframe).fadeOut(200),$("#btn_appsbar_"+windowId).hide(),$.desktopWindows.serviceappsbox.add({id:"btn_taskbar_"+windowId,img:p.defaults.windowicon,action:()=>{$.desktopWindows.serviceappsbox.hide(),$("#btn_appsbar_"+windowId).show(),$(p.windowframe).fadeIn(200);var button=$("#btn_taskbar_"+windowId);$.desktopWindows.serviceappsbox.appLinks=$.grep($.desktopWindows.serviceappsbox.appLinks,h=>h!=button[0]),button.remove()}}),null!=p.defaults.onminimize&&p.defaults.onminimize(p.windowId)}}}]}),$("#btn_appsbar_"+this.defaults.windowId).on("click",(function(e){var windowId=this.id.replace("btn_appsbar_",""),p=$.desktopWindows._getparms(windowId);p.isMinimized||!p.isMinimized&&$($.desktopWindows.desktop.element)!=$(p.windowframe).parent()?(p.isMinimized=!1,$.desktopWindows.desktop.element.appendChild(p.windowframe),(p.defaults.position&$.desktopWindows.STATIC)!=$.desktopWindows.STATIC&&$(p.windowframe).draggable({containment:$($.desktopWindows.desktop.element)}),$(p.windowframe).fadeIn(200),$.desktopWindows.maxzindex=parseInt($.desktopWindows.maxzindex)+1,$(p.windowframe).css("z-index",$.desktopWindows.maxzindex),null!=p.defaults.onrestore&&p.defaults.onrestore(p)):(p.isMinimized=!0,$(p.windowframe).fadeOut(200))})),this.appsbarbutton=$("#btn_appsbar_"+this.defaults.windowId),"0px"==$(".desktop-desktop-container").css("left")?$("#btn_appsbar_"+this.defaults.windowId).uiToolTip({position:$.uiToolTipPos.TOP}):$("#btn_appsbar_"+this.defaults.windowId).uiToolTip({position:$.uiToolTipPos.RIGHT})),this.defaults.appType==$.desktopWindows.APPSERVICE&&$.desktopWindows.serviceappsbox.add({id:"btn_taskbar_"+this.defaults.windowId,img:this.defaults.windowicon,action:()=>{$.desktopWindows.serviceappsbox.hide(),$(this.windowframe).fadeIn(200)}}),this.defaults.appType==$.desktopWindows.APPSETTING&&$.desktopWindows.settingsappsbox.add({id:"btn_taskbar_"+this.defaults.windowId,img:this.defaults.windowicon,tooltipContent:this.defaults.applicationName,action:()=>{$.desktopWindows.serviceappsbox.hide(),$(this.windowframe).fadeIn(200)}}));var initHeaderHeight=parseInt($(this.windowheader).css("height").replace("px","")),initBodyHeight=parseInt($(this.windowframe).css("height").replace("px","")),initStatusBarHeight=parseInt($(this.windowstatusbar).css("height").replace("px",""));if($(this.windowcontent).css("height",initBodyHeight-(initHeaderHeight+initStatusBarHeight)+"px"),null!=this.defaults.onresize)try{this.defaults.onresize(this,initBodyHeight-(initHeaderHeight+initStatusBarHeight))}catch(ex){}if(this.windowframe.style.visibility="",null!=this.defaults.onload)try{this.defaults.onload(this)}catch(ex){}}else null!=exsits.onminimize&&null!=exsits.windowicon&&($("#btn_appsbar_"+this.defaults.windowId).click(),$("#btn_appsbar_"+this.defaults.windowId).show(),$("#btn_taskbar_"+this.defaults.windowId).remove())}},getCssAjaxLoader:function(){return'<div class="cssload-loader"><div class="cssload-inner cssload-one"></div><div class="cssload-inner cssload-two"></div><div class="cssload-inner cssload-three"></div></div>'},maximize_restore:function(p){if(p.isMaximized){$(p.windowframe).css("position","absolute"),$(p.windowframe).css({transform:"translate("+p.isMaximized.X+"px,"+p.isMaximized.Y+"px)",transition:"0s"}),$(p.windowframe).css("width",p.isMaximized.Width+"px"),$(p.windowframe).css("height",p.isMaximized.Height+"px");var initHeaderHeight=parseInt($(p.windowheader).css("height").replace("px","")),initBodyHeight=parseInt($(p.windowframe).css("height").replace("px","")),initStatusBarHeight=parseInt($(p.windowstatusbar).css("height").replace("px",""));$(p.windowcontent).css("height",initBodyHeight-(initHeaderHeight+initStatusBarHeight)+"px"),$(p.windowframe).resizable("enable"),$(p.windowframe).draggable("enable"),p.isMaximized=null}else{var winform=$(p.windowframe),winformpos=winform.cssTranslateValues();p.isMaximized={X:parseInt(winformpos.x),Y:parseInt(winformpos.y),Width:parseInt(winform.css("width").replace("px","")),Height:parseInt(winform.css("height").replace("px",""))};var offset=$($.desktopWindows.desktop.element).offset();offset.width=parseInt(window.getComputedStyle($.desktopWindows.desktop.element,null).getPropertyValue("width").replace("px","")),offset.height=parseInt(window.getComputedStyle($.desktopWindows.desktop.element,null).getPropertyValue("height").replace("px","")),winform.css("position","fixed"),winform.css({transform:"translate("+offset.left+"px,"+offset.top+"px)",transition:"0s"}),winform.css("width",offset.width-offset.left-2*parseInt(winform.css("padding-left").replace("px",""))+"px"),winform.css("height",offset.height-offset.top-2*parseInt(winform.css("padding-left").replace("px",""))+"px");var initHeaderHeight=parseInt($(p.windowheader).css("height").replace("px","")),initBodyHeight=parseInt(winform.css("height").replace("px","")),initStatusBarHeight=parseInt($(p.windowstatusbar).css("height").replace("px",""));$(p.windowcontent).css("height",initBodyHeight-(initHeaderHeight+initStatusBarHeight)+"px"),winform.resizable("disable"),winform.draggable("disable")}},closeAll:function(){for(var i=0;i<$.desktopWindows.openwindows.length;i++)try{var winForm=$.desktopWindows.openwindows[i];if(winForm.defaults.onload=null,winForm.defaults.onclose=null,winForm.defaults.onresize=null,winForm.defaults.ondoubleclick=null,winForm.defaults.onfocus=null,winForm.defaults.onmaximize=null,null!=winForm.defaults.onminimize&&null!=winForm.defaults.windowicon){if($(winForm.defaults.windowId).ContextMenuDestroy(),winForm.defaults.appType==$.desktopWindows.APPNORMAL&&($("#btn_appsbar_"+winForm.defaults.windowId)[0].uiToolTip&&delete $("#btn_appsbar_"+winForm.defaults.windowId)[0].uiToolTip,$(winForm.appsbarbutton).remove()),winForm.defaults.appType==$.desktopWindows.APPSERVICE){var serviceButton=$.desktopWindows.serviceappsbox.element.find("#btn_taskbar_"+winForm.defaults.windowId);$.desktopWindows.serviceappsbox.appLinks=$.grep($.desktopWindows.serviceappsbox.appLinks,h=>h!=serviceButton[0]),serviceButton.remove()}if(winForm.defaults.appType==$.desktopWindows.APPSETTING){var settingButton=$.desktopWindows.settingsappsbox.element.find("#btn_taskbar_"+winForm.defaults.windowId);$.desktopWindows.settingsappsbox.appLinks=$.grep($.desktopWindows.settingsappsbox.appLinks,h=>h!=settingButton[0]),settingButton.remove()}}winForm.defaults.onminimize=null,$("#"+winForm.defaults.windowId).remove(),delete $.desktopWindows.openwindows[i],$.desktopWindows.openwindows.splice(i,1)}catch(sd){}$.desktopWindows.openwindows.length<=0&&($.desktopWindows.maxzindex=214748e4)},close:function(windowId){var p=$.desktopWindows._getparms(windowId);if(null!=p){var binds;$.desktopWindows._getshieldbound()<=1?$.desktopWindows.shield.hide():$.desktopWindows.shield.element.style.zIndex=$.desktopWindows.shield.element.style.zIndex-1;var ca=new $.inQuiry.cookie.create("desktopWindows_"+p.windowframe.id,null);null!=ca.read()&&ca.remove(),ca=new $.inQuiry.cookie.create("desktopWindows_"+p.windowframe.id,365);var pos=$(p.windowframe).cssTranslateValues();if(ca.keys.add(new $.inQuiry.cookie.item("x",pos.x+"px")),ca.keys.add(new $.inQuiry.cookie.item("y",pos.y+"px")),ca.keys.add(new $.inQuiry.cookie.item("w",document.getElementById(p.windowframe.id).style.width)),ca.keys.add(new $.inQuiry.cookie.item("h",document.getElementById(p.windowframe.id).style.height)),ca.save(),null!=p.defaults.onclose)try{p.defaults.onclose(p)}catch(ex){}$.desktopWindows._remove(windowId)}},setcontent:function(content){var $inquiry=$(content),windowTitle=$inquiry.attr("window-title"),windowId=$inquiry.attr("window-id"),isScroll=$inquiry.attr("window-scroll");if(null==windowId||""==windowId)return alert("System Exception: Could not find the window for this content. \r\nPlease make sure the first element has the correct windowTitle and windowId attributes."),null;null!=windowTitle&&""!=windowTitle||(windowTitle="Unknown");var p=$.desktopWindows._getparms(windowId);return p.windowcontent.innerHTML=content,p.windowtitle.innerHTML=windowTitle,p.windowcontent.firstChild.className="window-content-position "+p.windowcontent.firstChild.className,"true"==isScroll&&($(p.windowcontent).css("overflow-y","scroll"),$(p.windowcontent.firstChild).css("width","auto"),$(p.windowcontent.firstChild).css("width","")),null!=p.defaults.onminimize&&null!=p.icon&&($("#btn_appsbar_"+p.defaults.windowId).attr("ui-tooltip",windowTitle),$("#btn_appsbar_"+p.defaults.windowId)[0].uiToolTip.content=windowTitle),p},_getshieldbound:function(){for(var count=0,i=0;i<$.desktopWindows.openwindows.length;i++)!0===$.desktopWindows.openwindows[i].defaults.shield&&count++;return count},_getparms:function(windowId){var selected=$.desktopWindows.openwindows.filter(e=>e.defaults.windowId==windowId)[0];return null!=selected?selected:null},_remove:function(windowId){var selected=$.desktopWindows.openwindows.filter(e=>e.defaults.windowId==windowId)[0];return!(!selected||null==selected)&&($("#window_"+windowId).fadeOut(200,evt=>{try{if(selected.defaults.onload=null,selected.defaults.onclose=null,selected.defaults.onresize=null,selected.defaults.ondoubleclick=null,selected.defaults.onfocus=null,selected.defaults.onmaximize=null,null!=selected.defaults.onminimize&&null!=selected.defaults.windowicon){if($("#window_"+windowId).ContextMenuDestroy(),selected.defaults.appType==$.desktopWindows.APPNORMAL&&$(selected.appsbarbutton).remove(),selected.defaults.appType==$.desktopWindows.APPSERVICE){var serviceButton=$.desktopWindows.serviceappsbox.element.find("#btn_taskbar_"+selected.defaults.windowId);$.desktopWindows.serviceappsbox.appLinks=$.grep($.desktopWindows.serviceappsbox.appLinks,h=>h!=serviceButton[0]),serviceButton.remove()}if(selected.defaults.appType==$.desktopWindows.APPSETTING){var settingButton=$.desktopWindows.settingsappsbox.element.find("#btn_taskbar_"+selected.defaults.windowId);$.desktopWindows.settingsappsbox.settingLinks=$.grep($.desktopWindows.settingsappsbox.settingLinks,h=>h!=settingButton[0]),settingButton.remove()}}selected.onminimize=null,$("#window_"+windowId).remove(),$.desktopWindows.openwindows=$.grep($.desktopWindows.openwindows,(item,idx)=>item.defaults.windowId!=windowId),$.desktopWindows.openwindows.length<=0&&($.desktopWindows.maxzindex=214748e4)}catch(sd){}}),!0)},dialogBox:function(options){var defaults={title:"",width:500,height:375,shield:!0,onload:parms=>{},onclose:parms=>{}};return options=$.extend({},defaults,options),new $.desktopWindows.window({windowId:"dialog"+options.title.replaceAll(" ","").toLowerCase(),applicationName:options.title,width:options.width,height:options.height,position:$.desktopWindows.CENTER|$.desktopWindows.NORESIZE|$.desktopWindows.STATIC,margin:100,shield:options.shield,onload:parms=>{$(parms.windowtitle).text(parms.defaults.applicationName),$($(parms.windowcontent)[0].firstChild).remove(),options.onload(parms)},onclose:parms=>{options.onclose(parms)}}).load()},messageBox:function(options){var defaults={title:"",message:"",width:500,height:375,shield:!0,onOk:()=>{},onCancel:()=>{}};return options=$.extend({},defaults,options),new $.desktopWindows.window({windowId:"dialog"+options.title.replaceAll(" ","").toLowerCase(),applicationName:options.title,width:options.width,height:options.height,position:$.desktopWindows.CENTER|$.desktopWindows.NORESIZE|$.desktopWindows.STATIC,margin:100,shield:options.shield,onload:parms=>{$(parms.windowtitle).text(options.title),$($(parms.windowcontent)[0].firstChild).remove();var a=$("<div />",{id:"dialog-messagebox-container",class:"dialog-messagebox-container"}),b=$("<div />",{id:"dialog-messagebox-content",class:"dialog-messagebox-content",html:options.message});if(a.append(b),$(parms.windowcontent).append(a),null!=options.onOk){var c=$("<a />",{id:"dialog-messagebox-btncallok",class:"dialog-messagebox-btncallok",href:"javascript:void(0);",html:"Ok"});c.on("click",evt=>{options.onOk(evt)}),a.append(c),c[0].focus()}if(null!=options.onCancel){var d=$("<a />",{id:"dialog-messagebox-callcancel",class:"dialog-messagebox-callcancel",href:"javascript:void(0);",html:"Cancel"});d.on("click",evt=>{options.onCancel(evt),$.desktopWindows.close(parms.defaults.windowId)}),a.append(d)}$(parms.windowcontent).on("contextmenu",e=>(e.preventDefault(),!1))},onclose:parms=>{options.onCancel()}}).load()}},$.fn.clock=function(options){var defaults={type:"24hour"};options=$.extend({},defaults,options),clocktick(this,options),setInterval(()=>{clocktick(this,options)},1e3)},$.fn.clockdate=function(){clockdatetick(this),setInterval(()=>{clockdatetick(this)},1e3)};var clocktick=function(iqu,options){var defaults={type:"24hour"};options=$.extend({},defaults,options);var now=new Date,hours=now.getHours(),minutes=now.getMinutes(),timeOfDay="PM";hours<12&&(timeOfDay="AM"),hours<10&&(hours="0"+hours),minutes<10&&(minutes="0"+minutes),"24hour"==options.type?iqu.html(hours+":"+minutes):(hours=hours>12?hours-12:hours,iqu.html(hours+":"+minutes+" "+timeOfDay))},clockdatetick=function(iqu){var now=new Date,nowdate=now.toDateString();iqu.html(nowdate.replace(now.getFullYear(),""))};$.fn.desktopWindow=function(options){var defaults={desktopTitle:"Windows Desktop",desktopSwtichAnimation:!1,desktopBootLoaderShow:!1,deskTopClock:!1,deskTopClock24Hour:!1,deskTopDate:!1,deskTopCount:1,onDesktopSelected:()=>{},desktopOnClick:()=>{},appsBarOnClick:()=>{},taskBarOnClick:()=>{},calendarOnClick:evt=>{},onRenderd:()=>{}};options=$.extend({},defaults,options),$("html").css("overflow","hidden"),$("body").css("overflow","hidden");var environment=$(this[0]);environment.append($("<div />",{id:"desktop-wallpaper",class:"desktop-wallpaper"})),environment.append($("<div />",{id:"desktop-shield",class:"desktop-shield"})),environment.append($("<div />",{id:"desktop-container",class:"desktop-container"})),environment.append($("<div />",{id:"desktop-bootbox",class:"desktop-bootbox",style:"display:none;"})),options.desktopBootLoaderShow&&$("#desktop-bootbox").show(),$("#desktop-bootbox").html('<div class="window-content-loading">'+$.desktopWindows.getCssAjaxLoader()+"</div>");var tb=$("<div />",{id:"desktop-taskbar",class:"desktop-taskbar"});if(tb.append($('<a class="desktop-taskbar-title">'+options.desktopTitle+"</a>")),tb.append($("<a />",{id:"btn_taskbar_settings",class:"desktop-taskbar-icon desktop-taskbar-icon-settings",href:"javascript:void(0);"})),tb.append($("<a />",{id:"btn_taskbar_services",class:"desktop-taskbar-icon desktop-taskbar-icon-services",href:"javascript:void(0);"})),options.deskTopClock&&tb.append($("<a />",{id:"btn_taskbar_clock",class:"desktop-taskbar-text",href:"javascript:void(0);"})),options.deskTopDate&&tb.append($("<a />",{id:"btn_taskbar_calendar",class:"desktop-taskbar-text",href:"javascript:void(0);"})),tb.append($('<span class="desktop-taskbar-break">|</span>')),options.deskTopCount>1){for(var i=options.deskTopCount;i>0;i--)tb.append($("<a />",{id:"btn_taskbar_desktopswtich"+i,class:"desktop-taskbar-icon desktop-taskbar-icon-number","data-index":i,href:"javascript:void(0);"}));tb.append($('<span class="desktop-taskbar-break">|</span>'))}environment.append(tb),options.deskTopClock&&$("#btn_taskbar_clock").clock({type:1==options.deskTopClock24Hour?"24hour":"12hour"}),options.deskTopDate&&$("#btn_taskbar_calendar").clockdate(),$.desktopWindows.appsbar=new $.desktopWindows.setUpAppsBar(environment);for(var dts=$("<div />",{id:"desktop-desktops",class:"desktop-desktop-container"}),i=options.deskTopCount;i>0;i--){var defaultCss="display:none;";1==i&&(defaultCss="display:block;"),dts.append($("<div />",{id:"desktop"+(i-1),class:"desktop-desktop",style:defaultCss}))}if(environment.append(dts),$.desktopWindows.serviceappsbox=new $.desktopWindows.setUpServiceAppsBox(environment),$.desktopWindows.settingsappsbox=new $.desktopWindows.setUpSettingsAppsBox(environment),$.desktopWindows.shield=new $.desktopWindows.setUpShield("#desktop-shield","#202020",50),$.desktopWindows.taskbar=new $.desktopWindows.setUpTaskBar("#desktop-taskbar"),$.desktopWindows.desktop=new $.desktopWindows.setUpDesktop("#desktop0"),$("#btn_taskbar_clock").on("click",evt=>{options.calendarOnClick(evt)}),$("#btn_taskbar_calendar").on("click",evt=>{options.calendarOnClick(evt)}),$("body").prepend($("<div />",{class:"theme-base-colors"})),$(".desktop-desktop").on("click",e=>{e.currentTarget==e.target&&($.desktopWindows.desktop.appsbarSelectedApp="",options.desktopOnClick(e))}),$("#desktop-appsbar").on("click",e=>{e.currentTarget==e.target&&($.desktopWindows.desktop.appsbarSelectedApp="",options.appsBarOnClick(e))}),$("#desktop-taskbar").on("click",e=>{e.currentTarget==e.target&&($.desktopWindows.desktop.appsbarSelectedApp="",options.taskBarOnClick(e))}),$("#desktop-taskbar").on("contextmenu",(function(e){return e.preventDefault(),$.desktopWindows.desktop.appsbarSelectedApp="",!1})),$("#desktop-appsbar").on("contextmenu",(function(e){e.preventDefault();var isValid=!!e.target.offsetParent.id;return!!isValid&&("false"!=(isValid=$("#"+e.target.offsetParent.id).attr("contextmenu"))&&($.desktopWindows.desktop.appsbarSelectedApp=$("#"+e.target.offsetParent.id).attr("applicationname"),!1))})),$("#btn_taskbar_desktopswtich1").addClass("desktop-taskbar-icon-selected"),options.desktopSwtichAnimation&&options.deskTopCount>1&&window.gsap)for(var i=options.deskTopCount;i>0;i--)$("#btn_taskbar_desktopswtich"+i).hover((function(evt){for(var selectedDesktopId=parseInt(evt.target.id.replace("btn_taskbar_desktopswtich","")),b=options.deskTopCount;b>0;b--)b!=selectedDesktopId&&$("#desktop"+(b-1)).stop().css("opacity","").hide();gsap.timeline().to($("#desktop"+(selectedDesktopId-1)),.3,{scaleX:.5,scaleY:.5,rotation:15,onStart:function(){$("#desktop"+(selectedDesktopId-1)).css("border","2px solid "+$(".theme-base-colors").css("color")),$.desktopWindows.desktop.element!=$("#desktop"+(selectedDesktopId-1))[0]&&$("#desktop"+(selectedDesktopId-1)).show()}})}),(function(evt){var selectedDesktopId=parseInt(evt.target.id.replace("btn_taskbar_desktopswtich",""));$($.desktopWindows.desktop.element).fadeIn(10),gsap.timeline().to($("#desktop"+(selectedDesktopId-1)),.3,{scaleX:1,scaleY:1,rotation:0,onStart:function(){$.desktopWindows.desktop.element!=$("#desktop"+(selectedDesktopId-1))[0]&&$("#desktop"+(selectedDesktopId-1)).hide()},onComplete:function(){$("#desktop"+(selectedDesktopId-1)).css("border",""),$("#desktop"+(selectedDesktopId-1)).css("transform","")}})}));for(var desktopSwitch=idx=>{for(var i=options.deskTopCount;i>0;i--)idx!=i-1&&$("#desktop"+(i-1)).stop().css("opacity","").hide();$.desktopWindows.desktop.element=$("#desktop"+idx)[0];for(var i=options.deskTopCount;i>0;i--)$("#btn_taskbar_desktopswtich"+i).removeClass("desktop-taskbar-icon-selected");$("#btn_taskbar_desktopswtich"+("0"==idx?"1":parseInt(idx)+1)).addClass("desktop-taskbar-icon-selected"),$("#desktop"+idx).fadeIn(100)},i=options.deskTopCount;i>0;i--)$("#btn_taskbar_desktopswtich"+i).on("click",evt=>{var selectedDesktopId=parseInt(evt.target.id.replace("btn_taskbar_desktopswtich",""));desktopSwitch(selectedDesktopId-1),options.onDesktopSelected($("#desktop"+(selectedDesktopId-1)))});$(window).on("resize",e=>{"undefined"!=e.target.id&&null!=e.target.id||$.desktopWindows.shield.resize()}),options.desktopBootLoaderShow&&setTimeout(()=>{$("#desktop-bootbox").fadeOut(500,()=>{$("#desktop-bootbox").hide()})},1e3),options.onRenderd($.desktopWindows)}}(jQuery);